<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PrivateAI ‚Äì Local AI Assistant</title>
    <link rel="stylesheet" href="/styles.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css" id="highlightTheme">
  </head>
  <body>
    <header>
      <div class="header-copy">
        <h1>PrivateAI</h1>
        <p class="subtitle">100% Local AI Assistant</p>
      </div>
      <div class="header-actions">
        <button type="button" id="themeToggle" class="theme-toggle" title="Toggle theme">
          <span id="themeIcon">‚òÄÔ∏è</span>
        </button>
      </div>
    </header>

    <main>
      <section id="setupView" class="visible">
        <div class="setup-container">
          <div class="setup-logo">
            <div class="setup-logo-icon">ü§ñ</div>
            <h2 class="setup-title">Welcome to PrivateAI</h2>
            <p class="setup-description">
              Set up your private AI assistant in just a few clicks. Everything runs 100% locally on your device.
            </p>
          </div>

          <button id="startSetupBtn" class="primary setup-start-btn">Start Setup</button>

          <div class="backend-selector">
          <label for="backendSelect">Runtime engine</label>
          <select id="backendSelect">
            <option value="ollama">Ollama (default)</option>
            <option value="python">Python llama.cpp sidecar</option>
            <option value="embedded">Embedded llama.cpp (no dependencies)</option>
          </select>
          <p class="hint">
            Embedded runtime runs llama.cpp directly with zero external dependencies.
          </p>
        </div>

        <ol class="steps">
          <li data-step="scan">1</li>
          <li data-step="storage">2</li>
          <li data-step="install">3</li>
          <li data-step="model">4</li>
          <li data-step="complete">5</li>
        </ol>

        <div class="step-content">
          <div id="stepStatus">Press "Start Setup" to begin.</div>

          <div class="hardware-summary">
            <h3>Hardware snapshot</h3>
            <pre id="hardwareOutput">‚Äî</pre>
          </div>

          <div class="chat-storage">
            <div class="chat-storage-info">
              <label for="chatDirDisplay">Chat history folder</label>
              <p id="chatDirDisplay">Default: ~/PrivateAI/Chats</p>
            </div>
            <button type="button" id="chooseChatDirBtn" class="secondary small">Choose</button>
          </div>

          <div class="model-selector">
            <label for="modelSelect">Recommended model</label>
            <select id="modelSelect">
              <option value="llama3.1:8b">Llama 3.1 8B ‚Äî balanced</option>
              <option value="phi3:mini">Phi-3 Mini ‚Äî lightweight</option>
              <option value="deepseek-r1:7b">DeepSeek R1 7B ‚Äî reasoning</option>
            </select>
          </div>

          <div class="log-pane">
            <h3>Activity log</h3>
            <ul id="logEntries"></ul>
          </div>
        </div>
      </div>
      </section>

      <section id="chatView" class="hidden">
        <div class="chat-layout">
          <aside class="conversation-sidebar">
            <div class="conversation-header">
              <h2>Conversations</h2>
              <button type="button" id="newConversationBtn" class="secondary small">New chat</button>
            </div>
            <div class="conversation-scroll">
              <div id="conversationList" class="conversation-list"></div>
              <p id="conversationEmpty" class="conversation-empty">No conversations yet.</p>
            </div>
          </aside>
          <div class="chat-pane">
            <div class="chat-header">
              <div class="chat-header-text">
                <h2 id="conversationTitle">New chat</h2>
                <p class="chat-subtitle">Speak with your local assistant.</p>
              </div>
              <div class="chat-meta">
                <button type="button" id="settingsBtn" class="secondary small icon-button" title="Context & Model Settings">
                  Settings
                </button>
                <button type="button" id="changeChatDirBtn" class="secondary small icon-button" title="Choose chat storage folder">
                  Chat folder
                </button>
                <span id="activeModel">Model: ‚Äî</span>
                <button id="resetWizardBtn" class="secondary">Re-run setup</button>
              </div>
            </div>
            <div class="chat-history" id="chatHistory"></div>
            <form id="chatForm">
              <textarea id="chatInput" placeholder="Message PrivateAI..." rows="1"></textarea>
              <div class="controls">
                <button type="button" id="stopBtn" class="secondary stop-btn hidden">Stop</button>
                <button type="submit" id="sendBtn" class="primary" disabled>Send</button>
              </div>
            </form>
          </div>
        </div>
      </section>
    </main>

    <!-- Settings Modal -->
    <div id="settingsModal" class="modal hidden">
      <div class="modal-content">
        <div class="modal-header">
          <h2>Context & Model Settings</h2>
          <button type="button" id="closeSettingsBtn" class="close-btn">√ó</button>
        </div>
        <div class="modal-body">
          <div class="settings-section">
            <h3>Context Window Management</h3>
            <div class="setting-item">
              <label for="contextStrategy">Strategy</label>
              <select id="contextStrategy">
                <option value="all">Full History (send all messages)</option>
                <option value="sliding">Sliding Window (last N messages)</option>
                <option value="smart">Smart Limit (last N, keep important)</option>
              </select>
              <p class="setting-hint">How to manage conversation context sent to the model</p>
            </div>

            <div class="setting-item" id="maxMessagesContainer">
              <label for="maxMessages">Maximum Messages</label>
              <input type="number" id="maxMessages" min="2" max="100" value="20" />
              <p class="setting-hint">Number of recent messages to include (pairs of user/assistant)</p>
            </div>

            <div class="setting-item">
              <label for="maxTokens">Context Size (tokens)</label>
              <input type="number" id="maxTokens" min="512" max="32768" step="512" value="8192" />
              <p class="setting-hint">Approximate token limit for context (8192 ‚âà 6000 words)</p>
            </div>
          </div>

          <div class="settings-section">
            <h3>Model Parameters</h3>
            <div class="setting-item">
              <label for="temperature">Temperature: <span id="temperatureValue">0.7</span></label>
              <input type="range" id="temperature" min="0" max="2" step="0.1" value="0.7" />
              <p class="setting-hint">Higher = more creative, Lower = more focused</p>
            </div>
          </div>

          <div class="settings-section">
            <h3>Context Info</h3>
            <div class="context-stats">
              <p><strong>Current conversation:</strong> <span id="currentMessageCount">0</span> messages</p>
              <p><strong>Estimated tokens:</strong> <span id="estimatedTokens">0</span> tokens</p>
              <p><strong>Will send to model:</strong> <span id="willSendCount">0</span> messages</p>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" id="saveSettingsBtn" class="primary">Save Settings</button>
          <button type="button" id="cancelSettingsBtn" class="secondary">Cancel</button>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script src="/app.js"></script>
  </body>
</html>
